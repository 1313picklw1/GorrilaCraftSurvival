<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GorrilaCraftSurvival</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="info">
        <div>Score: <span id="score">0</span></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/loaders/GLTFLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/loaders/TextureLoader.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.25;
        controls.enableZoom = true;

        // Load textures
        const textureLoader = new THREE.TextureLoader();
        const textures = {
            grass: textureLoader.load('textures/blocks/grass_block.png'),
            dirt: textureLoader.load('textures/blocks/dirt.png'),
            stone: textureLoader.load('textures/blocks/stone.png'),
            // Add more textures here
        };

        // GLTFLoader for loading models
        const loader = new THREE.GLTFLoader();

        let gorilla;
        let resources = [];
        let score = 0;

        function loadGorillaModel() {
            loader.load('models/gorilla.glb', (gltf) => {
                gorilla = gltf.scene;
                gorilla.scale.set(1, 1, 1);
                scene.add(gorilla);
                gorilla.position.set(0, 0.5, 0);
                camera.position.set(0, 15, 15); // Adjusted for better view of the world
                camera.lookAt(0, 0, 0);
            });
        }

        function createTexturedBlock(texture, size) {
            const geometry = new THREE.BoxGeometry(size, size, size);
            const material = new THREE.MeshBasicMaterial({ map: texture });
            const cube = new THREE.Mesh(geometry, material);
            return cube;
        }

        function generateWorld(width, depth, blockSize) {
            for (let x = 0; x < width; x++) {
                for (let z = 0; z < depth; z++) {
                    let height = Math.sin(x * 0.1) * Math.cos(z * 0.1) * 5;

                    let texture;
                    if (height > 1) {
                        texture = textures.grass;
                    } else if (height > 0) {
                        texture = textures.dirt;
                    } else {
                        texture = textures.stone;
                    }

                    const block = createTexturedBlock(texture, blockSize);
                    block.position.set(x * blockSize, height * blockSize, z * blockSize);
                    scene.add(block);
                }
            }
        }

        function initGame() {
            // Load player model
            loadGorillaModel();

            // Generate world
            generateWorld(20, 20, 1);

            // Add some resources for collection
            for (let i = 0; i < 10; i++) {
                const texture = i % 2 === 0 ? textures.dirt : textures.stone;
                const resource = createTexturedBlock(texture, 0.5);
                resource.position.set(Math.random() * 20 - 10, 0.25, Math.random() * 20 - 10);
                scene.add(resource);
                resources.push(resource);
            }
        }

        function update() {
            if (gorilla) {
                resources.forEach((resource, index) => {
                    if (gorilla.position.distanceTo(resource.position) < 1) {
                        scene.remove(resource);
                        resources.splice(index, 1);
                        score++;
                        document.getElementById('score').textContent = score;
                    }
                });

                if (resources.length === 0) {
                    alert('You collected all resources! Game Over!');
                    resetGame();
                }
            }

            controls.update();
            renderer.render(scene, camera);
            requestAnimationFrame(update);
        }

        function resetGame() {
            scene.clear(); // Clear the scene
            initGame();    // Reinitialize the game
            score = 0;
            document.getElementById('score').textContent = score;
        }

        document.addEventListener('keydown', (event) => {
            if (gorilla) {
                switch (event.key) {
                    case 'ArrowUp':
                        gorilla.position.z -= 0.5;
                        break;
                    case 'ArrowDown':
                        gorilla.position.z += 0.5;
                        break;
                    case 'ArrowLeft':
                        gorilla.position.x -= 0.5;
                        break;
                    case 'ArrowRight':
                        gorilla.position.x += 0.5;
                        break;
                }
            }
        });

        // Initialize game
        initGame();
        update();
    </script>
</body>
</html>
